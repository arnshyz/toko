import path from "path";
import { renderTemplate } from "@/lib/email-template";
import { sendMail } from "@/lib/mail";

export async function sendRegistrationSuccessEmail(params: {
  email: string;
  name: string;
  loginUrl: string;
}) {
  const { email, name, loginUrl } = params;

  const html = await renderTemplate(
    path.join(process.cwd(), "templates/registration-success.html"),
    {
      app_name: "Toko Nusantara",
      user_salutation: "Sdr/i",
      user_name: name,
      user_email: email,
      account_id: crypto.randomUUID(), // opsional
      login_url: loginUrl,
      activated_datetime_local: new Intl.DateTimeFormat("id-ID", {
        dateStyle: "full",
        timeStyle: "short",
      }).format(new Date()),
      brand_logo_url: process.env.BRAND_LOGO_URL ?? "https://your-domain/logo.png",
      company_name: "PT Akay Nusantara",
      company_address_line: "Jl. Contoh No. 123, Sidoarjo",
      privacy_url: "https://your-domain/privacy",
      help_center_url: "https://your-domain/help",
      support_url: "https://your-domain/support",
      year: String(new Date().getFullYear()),
    }
  );

  await sendMail({
    to: email,
    subject: "Registrasi akun berhasil",
    text: `Halo ${name}, akun Toko Nusantara Anda sudah aktif. Masuk: ${loginUrl}`,
    html,
  });
}
